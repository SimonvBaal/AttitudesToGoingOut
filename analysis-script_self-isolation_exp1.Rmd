---
title: "Self-Isolation Exp 1"
author: "Simon van Baal"
date: "14/06/2020"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(afex)
library(ggplot2)
#library(stats4)
library(emmeans)

#library(grid)
library(ordinalCont)

```

```{r Load data, include = FALSE}
# Possible to skip data cleaning phase:

#dataExp1 <- read_csv("./data/going-out_experiment1_data.csv")
```


```{r Analysis, include = TRUE}

contrasts(dataExp1$Perspective) <- contr.sum(2)
contrasts(dataExp1$Sex) <- contr.sum(2)

ocmAllTreatment <-
  ocm(
    VAS ~
      Communication * Risk +
      Perspective +
      (1 | ResponseId),
    data = dataExp1,
    link = "logit"
  )

contrasts(dataExp1$Risk) <- contr.sum(3)

ocmTreatmentCommunication <-
  ocm(
    VAS ~
      Communication * Risk +
      Perspective +
      (1 | ResponseId),
    data = dataExp1,
    link = "logit"
  )

contrasts(dataExp1$Communication) <- contr.sum(3)
contrasts(dataExp1$Risk) <- contr.treatment(3)

ocmTreatmentRisk <- 
  ocm(VAS ~ 
        Communication*Risk +
        Perspective + 
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

dataExp1 <- 
  dataExp1 %>%
  mutate(Risk = relevel(Risk, ref = "Minimal Risk"))

ocmTreatmentRiskRelevel <- 
  ocm(VAS ~ 
        Communication*Risk +
        Perspective + 
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

dataExp1 <- 
  dataExp1 %>%
  mutate(Risk = relevel(Risk, ref = "Low Risk"))

ocmTreatmentRiskRelevel2 <- 
  ocm(VAS ~ 
        Communication*Risk +
        Perspective + 
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

contrasts(dataExp1$Communication) <- contr.sum(3)
contrasts(dataExp1$Risk) <- contr.sum(3)

# Age and sex effects

ocmAgeSex <- 
  ocm(
    VAS ~
      Communication * Risk +
      Perspective +
      AgeZeroCenter +
      Sex +
      (1 | ResponseId),
    data = dataExp1,
    link = "logit"
  )

## Testing for main effects

# ocm1 <- 
#   ocm(VAS ~ 
#         Communication*Risk +
#         Communication*Perspective +
#         AgeZeroCenter*Risk +
#         (1|ResponseId),
#       data = dataExp1,
#       link = "logit")
# 
# ocm2 <- 
#   ocm(VAS ~ 
#         Communication*Risk +
#         Communication*Perspective +
#         AgeZeroCenter +
#         (1|ResponseId),
#       data = dataExp1,
#       link = "logit")
# 
# ocm3 <- 
#   ocm(VAS ~ 
#         Communication*Risk +
#         Communication*Perspective +
#         (1|ResponseId),
#       data = dataExp1 %>% mutate(VAS = VAS/100),
#       link = "logit")
# 
ocm4 <-
  ocm(VAS ~
        Communication*Risk +
        Perspective +
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

ocm5 <-
  ocm(VAS ~
        Communication*Risk +
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

ocm6 <-
  ocm(VAS ~
        Communication + Risk +
        Perspective +
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

ocm7 <-
  ocm(VAS ~
        Communication + 
        Perspective +
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

ocm8 <-
  ocm(VAS ~ 
        Risk +
        Perspective
        (1|ResponseId),
      data = dataExp1,
      link = "logit")

# Comparison: 
anova(ocm4, ocm5)




```


```{r Check results with alternative analysis}
dataExp1 <-
  dataExp1 %>%
  mutate(VAScat = factor(ifelse(VAS <= .1, 1,
                                ifelse(
                                  VAS <= .20, 2,
                                  ifelse(VAS <= .30, 3,
                                         ifelse(VAS <= .40, 4,
                                                ifelse(
                                                  VAS <= .50, 5,
                                                  ifelse(VAS <= .60, 6,
                                                         ifelse(VAS <= .70, 7,
                                                                ifelse(
                                                                  VAS <= .80, 8,
                                                                  ifelse(VAS <= .90, 9,
                                                                         ifelse(VAS <= 1, 10))
                                                                )))
                                                )))
                                ))))

ordinalRegExp1 <- 
  ordinal::clmm(VAScat ~
      Communication * Risk +
      Perspective +
      AgeZeroCenter +
      Sex +
      (1 | ResponseId),
    data = dataExp1,
    link = "logit")

```

```{r Response scale}
## Risk factor coefficients
# Minimal Risk v High Risk
estimateMinimalHigh <- exp(-ocmTreatmentRisk$coefficients[5])
ciLowerMinimalHigh <- exp(-ocmTreatmentRisk$coefficients[5] - .0362*1.96)
ciUpperMinimalHigh <- exp(-ocmTreatmentRisk$coefficients[5] + .0362*1.96)

estimateLowHigh <- exp(-ocmTreatmentRisk$coefficients[4])
ciLowerLowHigh <- exp(-ocmTreatmentRisk$coefficients[4] - .0328*1.96)
ciUpperLowHigh <- exp(-ocmTreatmentRisk$coefficients[4] + .0328*1.96)

## Communication factor coefficients

estimateImperative <- exp(ocmTreatmentCommunication$coefficients[2])
ciLowerImperative <- exp(ocmTreatmentCommunication$coefficients[2]) - .144*1.96
ciUpperImperative <- exp(ocmTreatmentCommunication$coefficients[2]) + .144*1.96

estimateResponsibility <- exp(ocmTreatmentCommunication$coefficients[3])
ciLowerResponsibility <- exp(ocmTreatmentCommunication$coefficients[3]) - .145*1.96
ciUpperResponsibility <- exp(ocmTreatmentCommunication$coefficients[3]) + .145*1.96

# p value adjustment.
#p.adjust(c(.006, .44, .69), method = 'BH')

## Perspective factor coefficients

estimatePerspective <- exp(ocm4$coefficients[6]*2)
ciLowerPerspective <- exp(ocm4$coefficients[6]*2 - .0586*1.96)
ciUpperPerspective <- exp(ocm4$coefficients[6]*2 + .0586*1.96)
```

```{r reporting interactions}

## Interactions

# Minimal Risk

estimateImperativeMinimal <- exp(ocmTreatmentRiskRelevel$coefficients[2])
ciLowerImperativeMinimal <- exp(ocmTreatmentRiskRelevel$coefficients[2] - 
                                  .1558*1.96)
ciUpperImperativeMinimal <- exp(ocmTreatmentRiskRelevel$coefficients[2] + 
                                  .1558*1.96)

estimateResponsibilityMinimal <- exp(ocmTreatmentRiskRelevel$coefficients[3])
ciLowerResponsibilityMinimal <- exp(ocmTreatmentRiskRelevel$coefficients[3] - 
                                  .1568*1.96)
ciUpperResponsibilityMinimal <- exp(ocmTreatmentRiskRelevel$coefficients[3] + 
                                  .1568*1.96)

# Low Risk

estimateImperativeLow <- exp(ocmTreatmentRiskRelevel2$coefficients[2])
ciLowerImperativeLow <- exp(ocmTreatmentRiskRelevel2$coefficients[2] - 
                              .1540*1.96)
ciUpperImperativeLow <- exp(ocmTreatmentRiskRelevel2$coefficients[2] + 
                              .1540*1.96)

estimateResponsibilityLow <- exp(ocmTreatmentRiskRelevel2$coefficients[3])
ciLowerResponsibilityLow <- exp(ocmTreatmentRiskRelevel2$coefficients[3] - 
                                  .1551*1.96)
ciUpperResponsibilityLow <- exp(ocmTreatmentRiskRelevel2$coefficients[3] + 
                                  .1551*1.96)

# High Risk

estimateImperativeHigh <- exp(ocmAllTreatment$coefficients[2])
ciLowerImperativeHigh <- exp(ocmAllTreatment$coefficients[2] - 
                                  .1462*1.96)
ciUpperImperativeHigh <- exp(ocmAllTreatment$coefficients[2] + 
                                  .1462*1.96)

estimateResponsibilityHigh <- exp(ocmAllTreatment$coefficients[3])
ciLowerResponsibilityHigh <- exp(ocmAllTreatment$coefficients[3] - 
                                  .1472*1.96)
ciUpperResponsibilityHigh <- exp(ocmAllTreatment$coefficients[3] + 
                                  .1472*1.96)

```

```{r Age and Sex}

## Age
estimateAge <- exp(ocmAgeSex$coefficients[7])
ciLowerAge <- exp(ocmAgeSex$coefficients[7] -
                    .0044 * 1.96)
ciUpperAge <- exp(ocmAgeSex$coefficients[7] +
                    .0044 * 1.96)

# Sex
estimateSex <- exp(ocmAgeSex$coefficients[8])
ciLowerSex <- exp(ocmAgeSex$coefficients[8] -
                    .057 * 1.96)
ciUpperSex <- exp(ocmAgeSex$coefficients[8] +
                    .057 * 1.96)

```

```{r Perspective: assessing support for the null}

Exp1BayesFactorModels <-
  bayesfactor_models(ocm4, ocm5, denominator = 1)

Exp1BayesFactorInclusion <-
  bayesfactor_inclusion(Exp1BayesFactorModels)

Exp1BayesFactorInclusion
```
